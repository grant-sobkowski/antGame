/*! HTML-MSF-Basic-eCourse - 2019-08-06, 11:22 */
function CMAudioPlayer(){function onEnded(){callback&&callback()}var audio,callback=null;this.playFile=function(value,cb){var format="audio/mpeg",src=value;callback=cb,this.dispose(),void 0!==src&&void 0!==format&&(audio=new Audio,""!=audio.canPlayType(format)?(audio=new Audio,audio.autoplay=!0,audio.addEventListener("ended",onEnded),audio.src=src):audio=null)},this.dispose=function(){null!=audio&&(audio.pause(),audio=null)},this.log=function(){console.log("CMAudioPlayer: "+this.file)}}function Section(id,name,enabled,selected,inmenu){this.id=id,this.name=name,this.enabled=enabled,this.selected=selected,this.inmenu=inmenu,this.children=[],this.complete=!1}function Page(index,id,name,controller,href,templateUrl,complete,enabled,inmenu){this.index=index,this.id=id,this.name=name,this.controller=controller,this.reloadOnSearch=!1,this.href=href,this.templateUrl=templateUrl,this.complete=complete,this.enabled=enabled,this.inmenu=inmenu,this.selected=!1,this.backCommand=null,this.nextCommand=null,this.pageFinishedCommand=null,this.optional=!1}!function(angular,module,$){angular.module(module,[]),angular.module(module).run(function($window,$rootScope,$log){$rootScope.online=navigator.onLine,$window.addEventListener("offline",function(){$rootScope.$apply(function(){$rootScope.online=!1,$log.info("online: false")})},!1),$window.addEventListener("online",function(){$rootScope.$apply(function(){$rootScope.online=!0,$log.info("online: true")})},!1)})}(angular,"cm.network",$),function(angular,module){angular.module(module).directive("cmNetworkMessage",function(){return{restrict:"EA",replace:!0,template:'<div ng-hide="online" class="modal-backdrop" style="padding: 15px; pointer-events: none;"><div class="panel panel-danger" style="border-radius: 4px;"> <div class="panel-heading">Network Error</div><div class="panel-body"><h4>You\'re offline</h4><p>An internet connection is required to access this program.</p></div></div></div>',link:function(scope,element,attrs,ctrl){ctrl.init()},controllerAs:"vm",controller:function(){function init(){}var vm=this;vm.init=init}}})}(angular,"cm.network"),function(angular,module){angular.module(module,[])}(angular,"cm.scorm"),function(angular,module){angular.module(module).directive("cmScormMessage",function(){return{restrict:"E",replace:!0,template:'<div style="position: fixed; top: 0; right: 0; bottom: 0; left: 0; z-index: 1040; background-color: rgba(0, 0, 0, .8); padding: 15px; pointer-events: all;"><div class="panel panel-danger" style="border-radius: 4px; pointer-events: auto; max-width: 600px; min-height: 160px; margin: auto;"> <div class="panel-body text-center"><p>Oops! We\'re having trouble loading your course. You may be experiencing an internet connection issue. Please click on the button below to try again.</p><p><br/><button class="btn btn-danger" ng-click="tryAgain()">Try Again</button></p></div> </div>'}})}(angular,"cm.scorm"),angular.module("cm-widgets",[]).directive("progressBar",function($rootScope){return{restrict:"AE",replace:!0,scope:{min:"=",max:"=",value:"="},template:"<div class='progress-bar' role='progressbar' aria-valuenow={{value}} aria-valuemin='{{min}}' aria-valuemax='{{max}}' ng-attr-style='width: {{value}}%;' ng-hide='{{isVisible}}'></div>",link:function(scope,elem,attr){scope.isVisible=!1,$rootScope.$on("page-progress",function(event,arg){scope.isVisible=arg})}}}).directive("alert",function(){return{restrict:"E",scope:{topic:"@",description:"@",close:"&"},templateUrl:"scripts/common/templates/alert.html",replace:!0}}),angular.module("cm-components",[]).directive("listMenu",function(){var selectedItem=null,getTemplate=function(element,attrs){var template="scripts/common/templates/listmenu.html";return attrs.templateUrl?attrs.templateUrl:template},linker=function($scope,$element,$attrs){$scope.onSelect=function(v){if(null!=selectedItem){if(selectedItem==v)return;selectedItem.selected=!1}selectedItem=v,selectedItem.selected=!0,$scope.callback(v)}},controller=function($scope){selectedItem=null,$scope.callback=$scope.callback();for(var i=0;i<$scope.data.length;i++){var item=$scope.data[i];if(item.hasOwnProperty("children")){for(var j=0;j<item.children.length;j++)if(item.selected)return void(selectedItem=item)}else if(item.selected)return void(selectedItem=item)}};return{restrict:"EA",link:linker,controller:controller,templateUrl:getTemplate,scope:{callback:"&",data:"="}}}).directive("accordionMenu",function(ToHtmlConverter){var selectedItem=null,allowMultipleOpen=!1,getTemplate=function(element,attrs){var template="scripts/common/templates/acordion-template.html";return attrs.templateUrl?attrs.templateUrl:template},linker=function($scope,$element,$attrs){$scope.toHtmlConverter=ToHtmlConverter,$scope.onSelect=function(v){if(null!=selectedItem){if(1==v.selected&&selectedItem==v)return;selectedItem.selected=!1}selectedItem=v,selectedItem.selected=!0,$scope.callback(v)},$scope.onOpen=function(v){for(var i=0;i<$scope.data.length;i++){var item=$scope.data[i];item!=v&&item.selected&&(item.selected=!1)}v.selected=!v.selected}},controller=function($scope){selectedItem=null,$scope.callback=$scope.callback(),allowMultipleOpen="true"==$scope.allowMultipleOpen;for(var i=0;i<$scope.data.length;i++){var item=$scope.data[i];if(item.hasOwnProperty("children"))for(var j=0;j<item.children.length;j++){var child=item.children[j];if(child.selected)return void(selectedItem=child)}else if(item.selected)return void(selectedItem=item)}};return{restrict:"EA",link:linker,controller:controller,templateUrl:getTemplate,scope:{allowMultipleOpen:"@",callback:"&",data:"=",labelField:"="}}}),angular.module("cm-scorm",[]).constant("MODULE_VERSION","0.0.1").service("ScormService",function(){var service={};return service.version="1.2",service.SCORM_2004="2004",service.SCORM_1_2="1.2",service.connectionActive=!1,service.output=!1,service.stringToBoolean=function(str){if(null!=str)switch(str=str.toString(),str.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":return!1}return!1},service.connect=function(){var result=!1;if(this.output&&console.log("cm-scorm: "+this.version),service.connectionActive)this.output&&console.log("pipwerks.SCORM.init aborted: connection already active.");else{var callResponse=pipwerks.SCORM.init();result=service.stringToBoolean(callResponse),result?service.connectionActive=!0:this.output&&console.log("pipwerks.SCORM.init failed: no response from server.")}return result},service.get=function(param){var result="";return service.connectionActive&&(result=pipwerks.SCORM.get(param)),result},service.set=function(param,value){var result=!1;if(service.connectionActive){var callResult=pipwerks.SCORM.set(param,value);result=service.stringToBoolean(callResult),result||this.output&&console.log("pipwerks.SCORM.set("+param+") failed.")}else this.output&&console.log("pipwerks.SCORM.set("+param+") failed: connection is inactive.");return result},service.save=function(){var result=!1;if(service.connectionActive){var callResult=pipwerks.SCORM.save();result=service.stringToBoolean(callResult),result||this.output&&console.log("pipwerks.SCORM.save() failed.")}else this.output&&console.log("pipwerks.SCORM.save() failed: API connection is inactive.");return result},service.setExit=function(){service.version==service.SCORM_1_2||service.set("cmi.exit","suspend")},service.getLessonStatus=function(){return service.version==service.SCORM_1_2?service.get("cmi.core.lesson_status"):service.get("cmi.completion_status")},service.setLessonStatus=function(value){return service.version==service.SCORM_1_2?service.set("cmi.core.lesson_status",value):service.set("cmi.completion_status",value)},service.getLessonLocation=function(){return service.version==service.SCORM_1_2?(this.output&&console.log("getLessonLocation, Scorm 1.2"),service.get("cmi.suspend_data")):(this.output&&console.log("getLessonLocation, Scorm 2004"),service.get("cmi.suspend_data"))},service.setLessonLocation=function(value){return service.version==service.SCORM_1_2?service.set("cmi.suspend_data",value):service.set("cmi.suspend_data",value)},service.getStudentName=function(){return service.version==service.SCORM_1_2?service.get("cmi.core.student_name"):service.get("cmi.learner_name")},service.getCompletionDate=function(){return service.version==service.SCORM_1_2?service.get("cmi.comments"):service.get("cmi.comments_from_learner.0.timestamp")},service.setCompletionDate=function(timeStamp){return service.version==service.SCORM_1_2?service.set("cmi.comments",timeStamp):(this.output&&console.log("setCompletionData: "+timeStamp),service.set("cmi.comments_from_learner.0.timestamp",timeStamp))},service.setScore=function(score){return service.version==service.SCORM_1_2?service.set("cmi.core.score.raw",score):service.set("cmi.score.raw",score)},service}),angular.module("cm-certificate",[]).service("CertificateService",function(){this.createCertificate=function(name,date,identifier,imageName,fileName){var getImageFromUrl=function(url,callback){var data,img=new Image,ret={data:null,pending:!0};return img.onError=function(){throw new Error('Cannot load image: "'+url+'"')},img.onload=function(){var canvas=document.createElement("canvas");document.body.appendChild(canvas),canvas.width=img.width,canvas.height=img.height;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0),data=canvas.toDataURL("image/jpeg").slice("data:image/jpeg;base64,".length),data=atob(data),document.body.removeChild(canvas),ret.data=data,ret.pending=!1,"function"==typeof callback&&callback(data)},img.src=url,ret},createPDF=function(imgData){var doc=new jsPDF("landscape","pt","letter");doc.addImage(imgData,"JPEG",0,0,792,612);doc.getFontList();doc.setFontSize(18),doc.setFont("times"),doc.setFontType("normal"),doc.myText(identifier,{align:"center"},396,260),doc.myText(name,{align:"left"},170,310),doc.myText(date,{align:"left"},535,310),doc.output("save","Certificate.pdf")};getImageFromUrl(imageName,createPDF)}});var cm_test=angular.module("cm-test",[]);cm_test.factory("DataSource",["$http","MultipleChoiceParserService",function($http,MultipleChoiceParserService){var count=0;return{get:function(file,callback){$http.get(file,{transformResponse:function(data){var data=MultipleChoiceParserService.parse(data);return data}}).success(function(data,status){callback(data)}).error(function(data,status,headers,config){console.log("DataSource Error!"),count++,console.log("failed times: "+count)})}}}]),cm_test.service("MultipleChoiceParserService",function(){this.parse=function(data){var parser,xmlDoc,questionDataList,maxAttempts,autoStart,minScore,minPassAudioSrc,maxPassAudioSrc,failAudioSrc,correctAudioSrc,incorrectAudioSrc,result={},itemList=[],minPassAudio=null,maxPassAudio=null,failAudio=null,correctAudio=null,incorrectAudio=null,nextQuestionDelay=0,canReview=!1;try{parser=new DOMParser,xmlDoc=parser.parseFromString(data,"text/xml"),questionDataList=xmlDoc.getElementsByTagName("item"),maxAttempts=parseInt(xmlDoc.childNodes[0].getAttribute("maxAttempts")),autoStart="true"==xmlDoc.childNodes[0].getAttribute("autostart"),minScore=parseInt(xmlDoc.childNodes[0].getAttribute("minScore")),canReview="true"==xmlDoc.childNodes[0].getAttribute("canReview"),nextQuestionDelay=xmlDoc.childNodes[0].getAttribute("nextQuestionDelay"),nextQuestionDelay=null==nextQuestionDelay?0:parseInt(nextQuestionDelay),minPassAudioSrc=xmlDoc.childNodes[0].getAttribute("minPassAudio"),null!=minPassAudioSrc&&(minPassAudio=minPassAudioSrc),maxPassAudioSrc=xmlDoc.childNodes[0].getAttribute("maxPassAudio"),null!=maxPassAudioSrc&&(maxPassAudio=maxPassAudioSrc),failAudioSrc=xmlDoc.childNodes[0].getAttribute("failAudio"),null!=failAudioSrc&&(failAudio=failAudioSrc),correctAudioSrc=xmlDoc.childNodes[0].getAttribute("correctAudio"),null!=correctAudioSrc&&(correctAudio=correctAudioSrc),incorrectAudioSrc=xmlDoc.childNodes[0].getAttribute("incorrectAudio"),null!=incorrectAudioSrc&&(incorrectAudio=incorrectAudioSrc);for(var i=0;i<questionDataList.length;i++){var questionData,audioSrc,audio,correct,review,question,answerDataList,data=[];questionData=questionDataList[i],audioSrc=questionData.getAttribute("audio"),null!=audioSrc&&(audio=audioSrc),correct=parseInt(questionData.getAttribute("correct")),review=questionData.getAttribute("review"),question=questionData.getElementsByTagName("question")[0].childNodes[0].nodeValue,answerDataList=questionData.getElementsByTagName("answer");for(var j=0;j<answerDataList.length;j++){var answerData,answer;answerData=answerDataList[j],answer={name:answerData.childNodes[0].nodeValue,value:j+1},0==j&&(answer.fallback=!0),data.push(answer)}itemList.push({name:question,multi:!0,correct:correct,data:data,review:review,audio:audio,isCorrect:void 0})}result.maxAttempts=maxAttempts,result.minScore=minScore,result.itemList=itemList,result.minPassAudio=minPassAudio,result.maxPassAudio=maxPassAudio,result.failAudio=failAudio,result.autoStart=autoStart,result.nextQuestionDelay=nextQuestionDelay,result.correctAudio=correctAudio,result.incorrectAudio=incorrectAudio,result.canReview=canReview,result.isCorrect=!0}catch(e){alert("Failed to parse xml!")}return result}}),cm_test.directive("multipleChoice",["$http","$timeout","DataSource",function($http,$timeout,DataSource){function link($scope,$element,$attrs){function setAudio(value){currentAudio!=value&&0==$scope.inReview&&(stopAudio(),currentAudio=value)}function playAudio(){currentAudio&&!$scope.inReview&&AudioPlayer.playWithSource(currentAudio)}function stopAudio(){currentAudio&&AudioPlayer.pause()}function createReviewList(value){for(var result=[],i=0;i<value.length;i++){for(var item=value[i],found=!1,j=0;j<result.length&&!found;j++){var existingItem=result[j];existingItem==item.review&&(found=!0)}found||result.push(item.review)}return result}function onResult(data){$scope.itemList=data.itemList,$scope.minScore=data.minScore,$scope.maxAttempts=data.maxAttempts,minPassAudio=data.minPassAudio,maxPassAudio=data.maxPassAudio,failAudio=data.failAudio,autoStart=data.autoStart,incorrectAudio=data.incorrectAudio,correctAudio=data.correctAudio,nextQuestionDelay=data.nextQuestionDelay,$scope.canReview=data.canReview,$scope.init()}var minPassAudio=null,maxPassAudio=null,failAudio=null,correctAudio=null,incorrectAudio=null,currentAudio=null,nextQuestionDelay=0,autoStart=!1,alphabet=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];$scope.item=null,$scope.count=0,$scope.index=0,$scope.incorrectItemList=[],$scope.reviewList=[],$scope.minScore=100,$scope.maxAttempts=1,$scope.attempt=1,$scope.itemList=[],$scope.canReview=!1,$scope.inReview=!1,$scope.passed,$scope.complete=!1,$scope.started=!1,$scope.submitEnabled=!1,$scope.submitted=!1,$scope.init=function(){$scope.count=$scope.itemList.length,(autoStart||$scope.inReview)&&$scope.begin()},$scope.begin=function(){$scope.started=!0,$scope.startedCallback(),$scope.setItem($scope.itemList[$scope.index])},$scope.prev=function(){0!=$scope.index&&$scope.setItem($scope.itemList[--$scope.index])},$scope.next=function(){$scope.index!=$scope.count-1&&$scope.setItem($scope.itemList[++$scope.index])},$scope.setItem=function(item){item!=$scope.item&&($scope.submitted=!1,$scope.item=item,$scope.item&&$scope.item.audio&&setAudio($scope.item.audio),playAudio())},$scope.itemClicked=function(item){$scope.submitEnabled=!0},$scope.submit=function(){stopAudio(),0!=$scope.item.value.length&&($scope.submitEnabled=!1,$scope.submitted=!0,$scope.item.isCorrect=$scope.item.value[0]==$scope.item.correct,$scope.item.isCorrect?(correctAudio&&setAudio(correctAudio),playAudio()):(incorrectAudio&&setAudio(incorrectAudio),playAudio()),$scope.index==$scope.count-1?$timeout($scope.completed,nextQuestionDelay):$timeout($scope.next,nextQuestionDelay))},$scope.finish=function(){$scope.passed&&$scope.finishReviewCallback?$scope.finishReviewCallback():$scope.finishFailedCallback&&$scope.finishFailedCallback()},$scope.completed=function(){$scope.complete=!0;var score=$scope.score=$scope.getScore();score>=$scope.minScore?($scope.passed=!0,score>=100?(maxPassAudio&&setAudio(maxPassAudio),playAudio()):score>=$scope.minScore&&(minPassAudio&&setAudio(minPassAudio),playAudio(),$scope.canReview&&$scope.reviewIncorrectItemList()),$scope.finishPassedCallback&&$scope.finishPassedCallback()):$scope.attempt!=$scope.maxAttempts?($scope.attempt++,$scope.reset()):($scope.passed=!1,failAudio&&setAudio(failAudio),playAudio(),$scope.reviewList=createReviewList($scope.incorrectItemList),$scope.canReview&&$scope.reviewIncorrectItemList())},$scope.getScore=function(){for(var points=0,i=0;i<$scope.count;i++){var item=$scope.itemList[i];0!=item.isCorrect?points++:($scope.incorrectItemList.push(item),item.data[item.value[0]-1].active=!0)}var score=points/$scope.count*100;return score},$scope.reset=function(){$scope.incorrectItemList=[],$scope.index=0,$scope.passed=null;for(var i=0;i<$scope.count;i++){var item=$scope.itemList[i];item.value={}}$scope.init()},$scope.reviewIncorrectItemList=function(){$scope.inReview=!0,$scope.index=0,$scope.itemList=$scope.incorrectItemList;for(var i=0;i<$scope.incorrectItemList.length;i++){var item=$scope.incorrectItemList[i];item.data[item.correct-1].correct=!0}$scope.count=$scope.itemList.length,$scope.setItem($scope.itemList[$scope.index])},$scope.getAlphabet=function(index){return alphabet[index]},$scope.$on("$destroy",function(){AudioPlayer.pause(),$scope.reviewList=[],$scope.itemList=[],$scope.$destroy(),$timeout.cancel()});var file=$attrs.file;file?DataSource.get(file,onResult):console.log("file attribute not found!")}var getTemplate=function(element,attrs){var template="scripts/common/templates/multiplechoice.html";return attrs.templateUrl?attrs.templateUrl:template};return{restrict:"A",replace:!0,transclude:!0,link:link,templateUrl:getTemplate,scope:{finishPassedCallback:"&",finishFailedCallback:"&",finishReviewCallback:"&",startedCallback:"&"}}}]);var cm_media=angular.module("cm-media",[]);cm_media.service("CMAudioPlayer",CMAudioPlayer),cm_media.directive("cmPageAudioPlayer",function($compile){function link($scope,$element,$attrs,ctrl){var cueManager={ctrl:null},ctrlList=[cueManager];if("function"==typeof ctrl)ctrl=ctrl();else if(ctrl.length)for(var i=0;i<ctrl.length;i++)ctrlList[i].ctrl=ctrl[i];cueManager.ctrl&&($scope.cueManager=cueManager)}function controller($scope,$element,$attrs){var src,autoplay=!1;""!=$attrs.cmPageAudioPlayer?src=$attrs.cmPageAudioPlayer:"src"in $attrs&&(src=$attrs.src),$attrs.autoplay&&(autoplay="true"==$attrs.autoplay);var myObserver={update:function(){arguments[0].complete?($scope.finishCallback&&$scope.$eval($scope.finishCallback),$scope.$apply()):($scope.hr=arguments[0].hr,$scope.min=arguments[0].min,$scope.sec=arguments[0].sec,$scope.cueManager&&$scope.cueManager.ctrl.updateTime($scope.hr,$scope.min,$scope.sec))}};AudioPlayer.addObserver(myObserver),AudioPlayer.playWithSource(src),$element.append($compile($element.contents())($scope)),$element.on("$destroy",function(){AudioPlayer.removeObserver(myObserver)})}return{restrict:"AE",replace:!0,transclude:!0,template:"<div ng-transclude></div>",link:link,controller:["$scope","$element","$attrs",controller],require:["^?cueManager"],scope:{finishCallback:"&finishCallback",updateCallback:"&updateCallback",playingCallback:"&playingCallback"}}}),cm_media.directive("cmVideo",function($compile,$window,$document){function link($scope,$element,$attrs,ctrl){var cueManager={ctrl:null},ctrlList=[cueManager];if("function"==typeof ctrl)ctrl=ctrl();else if(ctrl.length)for(var i=0;i<ctrl.length;i++)ctrlList[i].ctrl=ctrl[i];cueManager.ctrl&&($scope.cueManager=cueManager)}function controller($scope,$element,$attrs){function calcPlayHead(value){var sec=Math.round(value%60),min=Math.floor(value/60),hr=Math.round(value/3600);return{hr:hr,min:min,sec:sec}}function onVidTimeUpdate(){var time=calcPlayHead(this.currentTime);$scope.progress=getPct(vid.currentTime,vid.duration),$scope.cueManager&&$scope.cueManager.ctrl.updateTime(time.hr,time.min,time.sec),$scope.$apply()}function getPct(value,max){return Math.round(value/max*100)}function stop(){vid&&vid.pause()}function play(){vid&&vid.play()}var vid=document.createElement("VIDEO");vid.src=$scope.vid,vid.width=590|$scope.width,vid.height=480|$scope.height,vid.autoplay=$scope.autoplay,vid.muted=muted,vid.onended=function(){$scope.finishCallback&&$scope.$eval($scope.finishCallback),$scope.$apply()},$(vid).on("play",function(){$scope.playingCallback&&($scope.$eval($scope.playingCallback),$scope.$apply())}),$(vid).bind("timeupdate",onVidTimeUpdate),$scope.$on("page-audio-play",function(){play()}),$scope.$on("page-audio-pause",function(){stop()}),$scope.$on("page-audio-mute",function(){muted=!0,vid&&(vid.muted=muted)}),$scope.$on("page-audio-un-mute",function(){muted=!1,vid&&(vid.muted=muted)});angular.element(vid);$element.append(vid)}var muted=!1;return{restrict:"AE",template:"<span></span>",controller:controller,link:link,require:["^?cueManager"],api:"=?",scope:{vid:"@",autoplay:"=",width:"=",height:"=",finishCallback:"&finishCallback",playingCallback:"&playingCallback"}}}),angular.module("cm-assessments",[]).directive("assessments",function(){var getTemplate=function(element,attrs){var template="scripts/common/templates/assessments.html";return attrs.templateUrl?attrs.templateUrl:template},linker=function($scope,elem,attrs){var feedbackAudio,feedbackAudioSrc;$scope.submit=function(){var result=$scope.validate();result&&($scope.completeFn(),feedbackAudio&&feedbackAudio.play())},$scope.validate=function(){for(var i=0;i<$scope.assessments.length;i++){var assessment=$scope.assessments[i];if(null==assessment.selectedItem)return!1}return!0},elem.on("$destroy",function(){feedbackAudio&&(feedbackAudio.pause(),feedbackAudio=null)}),feedbackAudioSrc=attrs.feedBackAudio,feedbackAudioSrc&&""!=feedbackAudioSrc?feedbackAudio=new Audio(feedbackAudioSrc):(feedbackAudio=null,feedbackAudioSrc=null)},controller=function($scope){$scope.assessments=[];var data=[],reviewData=[],reviewAssessments=[];$scope.data&&(data=$scope.data.split(",")),$scope.reviewData&&(reviewData=$scope.reviewData.split(",")),this.addAssessment=function(assessment){$scope.assessments.push(assessment);var index=$scope.assessments.length-1;assessment.index=index,data.length&&assessment.selectItemAt(parseInt(data[index]))},this.addReviewAssessment=function(assessment){reviewAssessments.push(assessment);var index=reviewAssessments.length-1;assessment.index=index,reviewData.length&&assessment.selectItemAt(parseInt(reviewData[index]))},this.update=function(){for(var i=0;i<$scope.assessments.length;i++){var assessment=$scope.assessments[i];null!=assessment.selectedItem&&(data[i]=assessment.selectedItem.index),$scope.onChangeFn({name:$scope.name,data:data.toString()})}if("true"==$scope.autoValidate){var result=$scope.validate();result&&$scope.completeFn()}}};return{restrict:"EA",link:linker,replace:!0,controller:controller,templateUrl:getTemplate,scope:{name:"@",completeFn:"&",onChangeFn:"&",data:"=",reviewData:"=",autoValidate:"@"}}}).directive("ratingAssessment",function(){var getTemplate=function(element,attrs){var template="scripts/common/templates/rating-assessment.html";return attrs.templateUrl?attrs.templateUrl:template},linker=function(scope,element,attrs,assessments){scope.selectedItem=null,scope.items=[];for(var i=0;i<scope.ticks;i++)scope.items.push({index:i,id:i,name:"name: "+i});scope.getRange=function(n){return new Array(n)},scope.onSelect=function(v){null!=scope.selectedItem&&(scope.selectedItem.selected=!1),scope.selectedItem=v,scope.selectedItem.selected=!0,assessments&&assessments.update()},scope.selectItemAt=function(n){scope.onSelect(scope.items[n])},assessments&&assessments.addAssessment(scope)};return{restrict:"EA",link:linker,templateUrl:getTemplate,require:"^assessments",scope:{question:"@",ticks:"=",selectFn:"&"}}}).directive("ratingAssessmentReview",function(){var getTemplate=function(element,attrs){var template="scripts/common/templates/rating-assessment.html";return attrs.templateUrl?attrs.templateUrl:template},linker=function(scope,element,attrs,assessments){scope.selectedItem=null,scope.items=[];for(var i=0;i<scope.ticks;i++)scope.items.push({index:i,id:i,name:"name: "+i});scope.getRange=function(n){return new Array(n)},scope.onSelect=function(v){null!=scope.selectedItem&&(scope.selectedItem.selected=!1),scope.selectedItem=v,scope.selectedItem.selected=!0},scope.selectItemAt=function(n){scope.onSelect(scope.items[n])},assessments&&assessments.addReviewAssessment(scope)};return{restrict:"EA",link:linker,templateUrl:getTemplate,require:"^assessments",scope:{question:"@",ticks:"=",selectFn:"&"}}}),angular.module("cm-persistent-data",[]).service("PersistentDataService",function($rootScope){return{get:PersistentData.get,add:PersistentData.add,toString:PersistentData.toString}}),angular.module("cm-functionalities",[]).directive("scrolly",function(){var controller=function($scope,$element,$attrs,$window,$document){var currentY=0,lastY=0;angular.element($window).bind("scroll",function(e){var pageYOffset=this.pageYOffset,offsetHeight=(parseInt(angular.element($element).prop("offsetTop")),parseInt($element.css("height")));$document[0].body,angular.element($window).height();return currentY=pageYOffset,currentY<=offsetHeight?void($attrs.reverse&&$element.removeClass($attrs.reverse)):void(currentY<lastY?(lastY=currentY,$attrs.reverse&&$element.addClass($attrs.reverse)):($attrs.reverse&&$element.removeClass($attrs.reverse),lastY=currentY-1))})};return{restrict:"A",replace:!1,controller:controller,scope:{offsetBody:"="}}}).directive("entering",function(){var controller=function($scope,$element,$attrs,$window,$document){var offset=100,elementPositionY=0,threshold=10;$attrs.offset&&(offset=parseInt($attrs.offset)),offset+=threshold;var getEndLocation=function(element){var location=0;if(element.offsetParent)do location+=element.offsetTop,element=element.offsetParent;while(element);return location=Math.max(location+offset,0)},body=$document[0].body,window=angular.element($window),windowRect={x:0,y:0,w:window.width(),h:window.height()},clientRect={x:0,y:body.scrollTop,w:body.clientWidth,h:body.clientHeight},execute=function(){clientRect.y=body.scrollTop,elementPositionY-windowRect.h-clientRect.y<=0?($element.removeClass($attrs.exiting),$element.addClass($attrs.entering)):($element.removeClass($attrs.entering),$element.addClass($attrs.exiting))};elementPositionY=getEndLocation($element[0]),angular.element($window).bind("scroll",function(e){execute()}),execute()};return{restrict:"A",replace:!1,controller:controller,scope:{}}});var cm_browser_util=angular.module("cm-browser-util",[]);cm_browser_util.service("BrowserUtilService",function(){var uAgent=navigator.userAgent.toLowerCase();this.isMobile=function(){var mobile=!1;return mobile=uAgent.search("iphone")>-1||(uAgent.search("iphone")>-1||(uAgent.search("ipad")>-1||(uAgent.search("android")>-1||(uAgent.search("blackberry")>-1||uAgent.search("webos")>-1))))}}),cm_browser_util.service("LangService",function($window){function isSupported(lang){for(var i=0;i<_supportedLanguages.length;i++)if(lang===_supportedLanguages[i])return!0;return!1}function init(){var lang=$window.navigator.language||$window.navigator.userLanguage,browserLanguage=lang.toLowerCase().substring(0,2);isSupported(browserLanguage)&&(self.currentLanguage=browserLanguage)}var self=this,_isEnabled=!1,_supportedLanguages=[],_config=null;self.currentLanguage="",self.init=function(config){_config=config,_isEnabled=config.enabled,_isEnabled&&(_supportedLanguages=config.values,self.setLanguage(config.value),init())},self.getEnabled=function(){return _isEnabled},self.getLanguage=function(){return self.currentLanguage},self.setLanguage=function(arg){if(_isEnabled){if(!isSupported(arg))throw Error("Error: "+arg+" is not a supported language option or was not defined in config! The available options are: "+_supportedLanguages.toString());self.currentLanguage=arg}},self.getSupportedLanguages=function(arg){return _supportedLanguages},self.getConfig=function(){return _config}});var cm_cue_system=angular.module("cm-cue-system",[]);cm_cue_system.service("CueManagerService",function(){}),cm_cue_system.directive("cueManager",function(){function link($scope,$element,$attrs){}function controller($scope,$element,$attrs){var dataProvider=[];$scope.selectedItem=null;var updateTime=function(hr,min,sec){hr=hr||0,min=min||0,sec=sec||0;for(var len=dataProvider.length,dp=dataProvider,i=0;i<len;i++){var item=dp[i];item.time.hr==hr&&item.time.min==min&&item.time.sec==sec&&(null!=$scope.selectedItem&&$scope.selectedItem.scope.api.setSelected(!1),$scope.selectedItem=item,$scope.selectedItem.scope.api.setSelected(!0))}};$scope.reset=function(){for(var len=dataProvider.length,i=0;i<len;i++){var item=dataProvider[i];item.scope.api.reset()}},this.add=function(element,attrs,scope){for(var i=0;i<dataProvider.length;i++){var item=dataProvider[i];if(element[0]==item.element[0])return}var time={hr:0,min:0,sec:0};if(attrs.time){var dataList=attrs.time.split(":");switch(dataList.reverse(),dataList.length){case 3:time.hr=parseInt(dataList[2]);case 2:time.min=parseInt(dataList[1]);case 1:time.sec=parseInt(dataList[0])}}var item={element:element,scope:scope,time:time};dataProvider.push(item)};var observer={update:function(){arguments[0].complete?$scope.reset():arguments[0].sec&&updateTime(arguments[0].hr,arguments[0].min,arguments[0].sec)}};AudioPlayer.addObserver(observer),$scope.$on("$destroy",function(){dataProvider=[],AudioPlayer.removeObserver(observer)})}return{restrict:"AE",replace:!0,transclude:!0,template:"<div ng-transclude></div>",controller:controller,link:link,scope:{options:"=ngInit",hr:"=hr",min:"=min",sec:"=sec",reverse:"=reverse"}}}),cm_cue_system.directive("cueItem",function($window,SmoothScrollTo){var link=function($scope,$element,$attrs,ctrl){var cueManager={ctrl:null},ctrlList=[cueManager];if("function"==typeof ctrl)ctrl=ctrl();else if(ctrl.length)for(var i=0;i<ctrl.length;i++)ctrlList[i].ctrl=ctrl[i];cueManager.ctrl&&cueManager.ctrl.add($element,$attrs,$scope)},controller=function($scope,$element,$attrs){function setSelected(bool){selected=bool,$element[(bool?"add":"remove")+"Class"]("active")}function reset(){selected=!1,$element.removeClass("active")}var selected=($scope.api={},!1);$scope.api={setSelected:setSelected,reset:reset}};return{restrict:"AE",replace:!0,transclude:!0,template:"<div ng-transclude></div>",link:link,controller:controller,require:["^?cueManager"],api:"=?",scope:{name:"@name",time:"@",hr:"=hr",min:"=min",sec:"=sec"}}}),cm_cue_system.directive("scrollToCueItem",function($compile){var link=function($scope,$element,$attrs,ctrl){var cueManager={ctrl:null},ctrlList=[cueManager];if("function"==typeof ctrl)ctrl=ctrl();else if(ctrl.length)for(var i=0;i<ctrl.length;i++)ctrlList[i].ctrl=ctrl[i];cueManager.ctrl&&cueManager.ctrl.add($element,$attrs,$scope)},controller=function($scope,$element,$attrs,SmoothScrollTo){function setSelected(bool){"none"!=$("#"+$attrs.id).css("display")&&(selected||(selected=bool,SmoothScrollTo.scrollToId($attrs.id)))}function reset(){selected=!1}var selected=($scope.api={},!1);$scope.api={setSelected:setSelected,reset:reset},$scope.$on("$destroy",function(){})};return{restrict:"AE",replace:!0,transclude:!0,template:"<div ng-transclude></div>",link:link,controller:controller,api:"=?",require:["^?cueManager"],scope:{time:"@",name:"@name",hr:"=hr",min:"=min",sec:"=sec"}}}),cm_cue_system.directive("cueItemClass",function(){var link=function($scope,$element,$attrs,ctrl){var cueManager={ctrl:null},ctrlList=[cueManager];if("function"==typeof ctrl)ctrl=ctrl();else if(ctrl.length)for(var i=0;i<ctrl.length;i++)ctrlList[i].ctrl=ctrl[i];cueManager.ctrl&&cueManager.ctrl.add($element,$attrs,$scope)},controller=function($scope,$element,$attrs){var api=$scope.api={};api.setSelected=function(bool){$element.addClass($attrs.show)}};return{restrict:"AE",replace:!1,link:link,controller:controller,
require:["^?cueManager"],api:"=?",scope:{time:"@"}}});var cm_utils=angular.module("cm-utils",[]);cm_utils.service("ToHtmlConverter",function($sce){this.getContent=function(v){return $sce.trustAsHtml(v)}}),cm_utils.directive("script",function(){return{restrict:"E",scope:!1,link:function(scope,elem,attr){if("text/javascript-lazy"==attr.type){var code=elem.text(),f=new Function(code);f()}}}}),cm_utils.directive("scriptSource",function(){return{restrict:"E",scope:!1,link:function(scope,elem,attr){if("text/javascript-lazy"===attr.type){var s=document.createElement("script");s.type="text/javascript";var src=elem.attr("src");if(void 0!==src)s.src=src;else{var code=elem.text();s.text=code}document.head.appendChild(s),elem.remove()}}}}),cm_utils.directive("renderHtml",function(){function link($scope,$elem,$attrs){console.log($elem.html())}return{restrict:"EA",scope:!1,replace:!0,link:link,template:"<span></span>"}});var cm_vimeo=angular.module("cm-vimeo",[]);cm_vimeo.directive("cmVimeos",function($window){function link($scope,$element,$attrs){}function controller($scope,$element,$attrs){function allComplete(){for(var i=0;i<dataProvider.length;i++){var item=dataProvider[i];if(!item.complete)return!1}return!0}function getPlayer(playerId){for(var i=0;i<dataProvider.length;i++){var player=dataProvider[i];if(playerId==player.id)return player}return null}var dataProvider=[];this.onFinished=function(playerId){if(playerId){var player=getPlayer(playerId);player&&(player.complete=!0)}var complete=allComplete();complete&&($scope.finishCallback&&$scope.$eval($scope.finishCallback),$scope.$apply())},this.add=function(id,scope){var player={id:id,complete:!1,api:scope.api};dataProvider.push(player)},$scope.$on("$destroy",function(){for(;dataProvider.length;){dataProvider.shift()}})}return{restrict:"AE",replace:!0,transclude:!0,controller:controller,link:link,template:"<div ng-transclude></div>",scope:{finishCallback:"&finishCallback"}}}),cm_vimeo.directive("cmVimeo",function($compile,$window,$sce,$timeout){function linker($scope,$element,$attrs,ctrl){var vimeos={ctrl:null},cueManager={ctrl:null},ctrlList=[vimeos,cueManager],autoplay=!1;if($attrs.autoplay&&(autoplay="true"==$attrs.autoplay),"function"==typeof ctrl)ctrl=ctrl();else if(ctrl.length)for(var i=0;i<ctrl.length;i++)ctrlList[i].ctrl=ctrl[i];var url="https://player.vimeo.com/video/"+$attrs.vid+"?player_id="+$attrs.vid+"&autoplay="+autoplay;vimeos.ctrl&&vimeos.ctrl.add($attrs.vid,$scope),cueManager.ctrl&&($scope.cueManager=cueManager),$scope.$on("$destroy",function(){}),$timeout(function(){var elStr='<div class="js-video widescreen"><iframe id="'+$attrs.vid+'" src="'+url+'" width="100%" height="100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>';$element.append(angular.element(elStr));var iframe=$element.find("iframe"),player=new Vimeo.Player(iframe);player.on("ended",function(v){vimeos.ctrl&&vimeos.ctrl.onFinished($attrs.vid)})},1e3)}function controller($scope,$element,$attrs){var api=$scope.api={};$scope.videoEvent={duration:0,seconds:0,percent:0},$scope.complete=!1,api.finished=function(bool){$scope.complete=bool,$element[(bool?"add":"remove")+"Class"]("active"),$scope.finishCallback&&$scope.$eval($scope.finishCallback)},api.onProgress=function(event){event.seconds=Math.ceil(event.seconds),$scope.cueManager&&$scope.cueManager.ctrl.updateTime(0,0,event.seconds),$scope.$apply(function(){$scope.status=event})},$scope.$on("$destroy",function(){$("iframe").removeAttr("src")})}return{restrict:"AE",replace:!0,transclude:!0,template:"<div ng-transclude></div>",controller:controller,link:linker,require:["^?cmVimeos","^?cueManager"],api:"=?",scope:{vid:"=",finishCallback:"&finishCallback"}}});var XMLUtils=function(){function getXmlHttpObject(){return window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null}function loadXMLDoc(filename){var xhttp=getXmlHttpObject();return xhttp.open("GET",filename,!1),xhttp.send(),xhttp.responseXML}return{loadXMLDoc:loadXMLDoc}}(),Utilities=function(){function getElementLocation(element){var location=0;if(element.offsetParent)do location+=element.offsetTop,element=element.offsetParent;while(element);return location=Math.max(location,0)}return{getElementLocation:getElementLocation}}(),pipwerks={};pipwerks.UTILS={},pipwerks.debug={isActive:!0},pipwerks.SCORM={version:null,handleCompletionStatus:!0,handleExitMode:!0,API:{handle:null,isFound:!1},connection:{isActive:!1},data:{completionStatus:null,exitStatus:null},debug:{}},pipwerks.SCORM.isAvailable=function(){return!0},pipwerks.SCORM.API.find=function(win){for(var API=null,findAttempts=0,findAttemptLimit=500,traceMsgPrefix="SCORM.API.find",trace=pipwerks.UTILS.trace,scorm=pipwerks.SCORM;!win.API&&!win.API_1484_11&&win.parent&&win.parent!=win&&findAttempts<=findAttemptLimit;)findAttempts++,win=win.parent;if(scorm.version)switch(scorm.version){case"2004":win.API_1484_11?API=win.API_1484_11:trace(traceMsgPrefix+": SCORM version 2004 was specified by user, but API_1484_11 cannot be found.");break;case"1.2":win.API?API=win.API:trace(traceMsgPrefix+": SCORM version 1.2 was specified by user, but API cannot be found.")}else win.API_1484_11?(scorm.version="2004",API=win.API_1484_11):win.API&&(scorm.version="1.2",API=win.API);return API?(trace(traceMsgPrefix+": API found. Version: "+scorm.version),trace("API: "+API)):trace(traceMsgPrefix+": Error finding API. \nFind attempts: "+findAttempts+". \nFind attempt limit: "+findAttemptLimit),API},pipwerks.SCORM.API.get=function(){var API=null,win=window,find=pipwerks.SCORM.API.find,trace=pipwerks.UTILS.trace;return win.parent&&win.parent!=win&&(API=find(win.parent)),!API&&win.top.opener&&(API=find(win.top.opener)),API?pipwerks.SCORM.API.isFound=!0:trace("API.get failed: Can't find the API!"),API},pipwerks.SCORM.API.getHandle=function(){var API=pipwerks.SCORM.API;return API.handle||API.isFound||(API.handle=API.get()),API.handle},pipwerks.SCORM.connection.initialize=function(){var success=!1,scorm=pipwerks.SCORM,completionStatus=pipwerks.SCORM.data.completionStatus,trace=pipwerks.UTILS.trace,makeBoolean=pipwerks.UTILS.StringToBoolean,debug=pipwerks.SCORM.debug,traceMsgPrefix="SCORM.connection.initialize ";if(trace("connection.initialize called."),scorm.connection.isActive)trace(traceMsgPrefix+"aborted: Connection already active.");else{var API=scorm.API.getHandle(),errorCode=0;if(API){switch(scorm.version){case"1.2":success=makeBoolean(API.LMSInitialize(""));break;case"2004":success=makeBoolean(API.Initialize(""))}if(success)if(errorCode=debug.getCode(),null!==errorCode&&0===errorCode){if(scorm.connection.isActive=!0,scorm.handleCompletionStatus&&(completionStatus=pipwerks.SCORM.status("get")))switch(completionStatus){case"not attempted":pipwerks.SCORM.status("set","incomplete");break;case"unknown":pipwerks.SCORM.status("set","incomplete")}}else success=!1,trace(traceMsgPrefix+"failed. \nError code: "+errorCode+" \nError info: "+debug.getInfo(errorCode));else errorCode=debug.getCode(),trace(null!==errorCode&&0!==errorCode?traceMsgPrefix+"failed. \nError code: "+errorCode+" \nError info: "+debug.getInfo(errorCode):traceMsgPrefix+"failed: No response from server.")}else trace(traceMsgPrefix+"failed: API is null.")}return success},pipwerks.SCORM.connection.terminate=function(){var success=!1,scorm=pipwerks.SCORM,exitStatus=pipwerks.SCORM.data.exitStatus,completionStatus=pipwerks.SCORM.data.completionStatus,trace=pipwerks.UTILS.trace,makeBoolean=pipwerks.UTILS.StringToBoolean,debug=pipwerks.SCORM.debug,traceMsgPrefix="SCORM.connection.terminate ";if(scorm.connection.isActive){var API=scorm.API.getHandle(),errorCode=0;if(API){if(scorm.handleExitMode&&!exitStatus)if("completed"!==completionStatus&&"passed"!==completionStatus)switch(scorm.version){case"1.2":success=scorm.set("cmi.core.exit","suspend");break;case"2004":success=scorm.set("cmi.exit","suspend")}else switch(scorm.version){case"1.2":success=scorm.set("cmi.core.exit","logout");break;case"2004":success=scorm.set("cmi.exit","normal")}switch(scorm.version){case"1.2":success=makeBoolean(API.LMSFinish(""));break;case"2004":success=makeBoolean(API.Terminate(""))}success?scorm.connection.isActive=!1:(errorCode=debug.getCode(),trace(traceMsgPrefix+"failed. \nError code: "+errorCode+" \nError info: "+debug.getInfo(errorCode)))}else trace(traceMsgPrefix+"failed: API is null.")}else trace(traceMsgPrefix+"aborted: Connection already terminated.");return success},pipwerks.SCORM.data.get=function(parameter){var value=null,scorm=pipwerks.SCORM,trace=pipwerks.UTILS.trace,debug=pipwerks.SCORM.debug,traceMsgPrefix="SCORM.data.get("+parameter+") ";if(scorm.connection.isActive){var API=scorm.API.getHandle(),errorCode=0;if(API){switch(scorm.version){case"1.2":value=API.LMSGetValue(parameter);break;case"2004":value=API.GetValue(parameter)}if(errorCode=debug.getCode(),""!==value&&0===errorCode)switch(parameter){case"cmi.core.lesson_status":case"cmi.completion_status":scorm.data.completionStatus=value;break;case"cmi.core.exit":case"cmi.exit":scorm.data.exitStatus=value}else trace(traceMsgPrefix+"failed. \nError code: "+errorCode+"\nError info: "+debug.getInfo(errorCode))}else trace(traceMsgPrefix+"failed: API is null.")}else trace(traceMsgPrefix+"failed: API connection is inactive.");return trace(traceMsgPrefix+" value: "+value),String(value)},pipwerks.SCORM.data.set=function(parameter,value){var success=!1,scorm=pipwerks.SCORM,trace=pipwerks.UTILS.trace,makeBoolean=pipwerks.UTILS.StringToBoolean,debug=pipwerks.SCORM.debug,traceMsgPrefix="SCORM.data.set("+parameter+") ";if(scorm.connection.isActive){var API=scorm.API.getHandle(),errorCode=0;if(API){switch(scorm.version){case"1.2":success=makeBoolean(API.LMSSetValue(parameter,value));break;case"2004":success=makeBoolean(API.SetValue(parameter,value))}success?"cmi.core.lesson_status"!==parameter&&"cmi.completion_status"!==parameter||(scorm.data.completionStatus=value):trace(traceMsgPrefix+"failed. \nError code: "+errorCode+". \nError info: "+debug.getInfo(errorCode))}else trace(traceMsgPrefix+"failed: API is null.")}else trace(traceMsgPrefix+"failed: API connection is inactive.");return success},pipwerks.SCORM.data.save=function(){var success=!1,scorm=pipwerks.SCORM,trace=pipwerks.UTILS.trace,makeBoolean=pipwerks.UTILS.StringToBoolean,traceMsgPrefix="SCORM.data.save failed";if(scorm.connection.isActive){var API=scorm.API.getHandle();if(API)switch(scorm.version){case"1.2":success=makeBoolean(API.LMSCommit(""));break;case"2004":success=makeBoolean(API.Commit(""))}else trace(traceMsgPrefix+": API is null.")}else trace(traceMsgPrefix+": API connection is inactive.");return success},pipwerks.SCORM.status=function(action,status){var success=!1,scorm=pipwerks.SCORM,trace=pipwerks.UTILS.trace,traceMsgPrefix="SCORM.getStatus failed",cmi="";if(null!==action){switch(scorm.version){case"1.2":cmi="cmi.core.lesson_status";break;case"2004":cmi="cmi.completion_status"}switch(action){case"get":success=pipwerks.SCORM.data.get(cmi);break;case"set":null!==status?success=pipwerks.SCORM.data.set(cmi,status):(success=!1,trace(traceMsgPrefix+": status was not specified."));break;default:success=!1,trace(traceMsgPrefix+": no valid action was specified.")}}else trace(traceMsgPrefix+": action was not specified.");return success},pipwerks.SCORM.debug.getCode=function(){var API=pipwerks.SCORM.API.getHandle(),scorm=pipwerks.SCORM,trace=pipwerks.UTILS.trace,code=-1;if(API)switch(code=0,scorm.version){case"1.2":code=parseInt(API.LMSGetLastError(),10);break;case"2004":code=parseInt(API.GetLastError(),10)}else trace("SCORM.debug.getCode failed: API is null.");return code},pipwerks.SCORM.debug.getInfo=function(errorCode){var API=pipwerks.SCORM.API.getHandle(),scorm=pipwerks.SCORM,trace=pipwerks.UTILS.trace,result="";if(API)switch(scorm.version){case"1.2":result=API.LMSGetErrorString(errorCode.toString());break;case"2004":result=API.GetErrorString(errorCode.toString())}else trace("SCORM.debug.getInfo failed: API is null.");return String(result)},pipwerks.SCORM.debug.getDiagnosticInfo=function(errorCode){var API=pipwerks.SCORM.API.getHandle(),scorm=pipwerks.SCORM,trace=pipwerks.UTILS.trace,result="";if(API)switch(scorm.version){case"1.2":result=API.LMSGetDiagnostic(errorCode);break;case"2004":result=API.GetDiagnostic(errorCode)}else trace("SCORM.debug.getDiagnosticInfo failed: API is null.");return String(result)},pipwerks.SCORM.init=pipwerks.SCORM.connection.initialize,pipwerks.SCORM.get=pipwerks.SCORM.data.get,pipwerks.SCORM.set=pipwerks.SCORM.data.set,pipwerks.SCORM.save=pipwerks.SCORM.data.save,pipwerks.SCORM.quit=pipwerks.SCORM.connection.terminate,pipwerks.UTILS.StringToBoolean=function(string){switch(string.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(string)}},pipwerks.UTILS.trace=function(msg){pipwerks.debug.isActive&&window.console&&window.console.firebug&&console.log(msg)};var Scorm=function(scorm){function init(){return!!_scorm&&(_scorm.version=_version,connect())}function initWithVersion(v){return!(!_scorm||(_scorm.version=_version=v,!_enabled))&&connect()}function isConnectionActive(){if(_scorm){_scorm.connection.isActive=_connectionActive=!0;var errorCode=(getLessonStatus(),getCode());if(0===errorCode)return!0;_scorm.connection.isActive=_connectionActive=!1}return!1}function stringToBoolean(str){if(null!=str)switch(str=str.toString(),str.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":return!1}return!1}function connect(){var result=!1;if(_output&&trace("cm-scorm: "+_version),!_connectionActive){var callResponse=_scorm.init();result=stringToBoolean(callResponse),result&&(_connectionActive=!0)}return result}function set(param,value){var result=!1;if(_connectionActive){var callResult=_scorm.set(param,value);result=stringToBoolean(callResult),result||trace("pipwerks.SCORM.set("+param+") failed.")}else trace("pipwerks.SCORM.set("+param+") failed: connection is inactive.");return result}function get(param){var result="";return _connectionActive&&(result=_scorm.get(param)),result}function save(){var result=!1;if(_connectionActive){var callResult=_scorm.save();result=stringToBoolean(callResult),result||trace("pipwerks.SCORM.save() failed.")}else _output&&trace("pipwerks.SCORM.save() failed: API connection is inactive.");return result}function setExit(){_version==SCORM_1_2||set("cmi.exit","suspend")}function getLessonStatus(){return get(_version==SCORM_1_2?"cmi.core.lesson_status":"cmi.completion_status")}function setLessonStatus(value){return _version==SCORM_1_2?set("cmi.core.lesson_status",value):set("cmi.completion_status",value)}function getLessonLocation(){return _version==SCORM_1_2?(_output&&trace("getLessonLocation, Scorm 1.2"),get("cmi.suspend_data")):(_output&&trace("getLessonLocation, Scorm 2004"),get("cmi.suspend_data"))}function setLessonLocation(value){return _version==SCORM_1_2?set("cmi.suspend_data",value):set("cmi.suspend_data",value)}function getStudentId(){return get(_version==SCORM_1_2?"cmi.core.student_id":"cmi.learner_id")}function getStudentName(){return get(_version==SCORM_1_2?"cmi.core.student_name":"cmi.learner_name")}function getCompletionDate(){return get(_version==SCORM_1_2?"cmi.comments":"cmi.comments_from_learner.0.timestamp")}function setCompletionDate(timeStamp){return _version==SCORM_1_2?set("cmi.comments",timeStamp):(_output&&trace("setCompletionData: "+timeStamp),set("cmi.comments_from_learner.0.timestamp",timeStamp))}function setScore(score){return _version==SCORM_1_2?set("cmi.core.score.raw",score):set("cmi.score.raw",score)}function toString(){return"Scorm version: "+_version}function setVersion(v){_scorm&&(_scorm.version=v)}function setEnabled(v){_enabled=v}function getEnabled(){return _enabled}function getCode(){return _scorm.debug.getCode()}function trace(msg){window.console&&console.log(msg)}function quit(){if(_connectionActive)return _scorm.quit()}function getDiagnosticInfo(errorCode){return _scorm.debug.getDiagnosticInfo(errorCode)}function getInfo(errorCode){return _scorm.debug.getInfo(errorCode)}var SCORM_1_2="1.2",_scorm=scorm,_version="1.2",_connectionActive=!1,_output=!1,_enabled=!0;return{init:init,initWithVersion:initWithVersion,setVersion:setVersion,setScore:setScore,setCompletionDate:setCompletionDate,getCompletionDate:getCompletionDate,getStudentName:getStudentName,getStudentId:getStudentId,setLessonLocation:setLessonLocation,getLessonLocation:getLessonLocation,setLessonStatus:setLessonStatus,getLessonStatus:getLessonStatus,setEnabled:setEnabled,getEnabled:getEnabled,save:save,setExit:setExit,toString:toString,getCode:getCode,quit:quit,getDiagnosticInfo:getDiagnosticInfo,getInfo:getInfo,isConnectionActive:isConnectionActive}}(pipwerks.SCORM),PersistentData=function(){function init(){console.log("PersistentData Module ready!")}function get(name){return _persistentObject&&_persistentObject.hasOwnProperty(name)?_persistentObject[name]:null}function add(name,data){_persistentObject&&(_persistentObject[name]=data,notify())}function save(){notify()}function toString(){var result="";if(_persistentObject)for(var property in _persistentObject)result+=property+":"+_persistentObject[property]+"^";return result=result.slice(0,result.length-1)}function notify(){_onDataChanged&&_onDataChanged()}function getPersistentObject(){return _persistentObject}function setOnDataChanged(v){_onDataChanged=v}var _onDataChanged,_persistentObject={};return{init:init,get:get,add:add,save:save,getPersistentObject:getPersistentObject,toString:toString,setOnDataChanged:setOnDataChanged}}(),Bookmark=function(scorm,persistentData){function Bookmark($q,$timeout,$log){function initLessonStatus(){var deferred=$q.defer(),success=!1,lessonStatus=scorm.getLessonStatus(),errorCode=scorm.getCode();return 0!==errorCode?($log.log("ErrorCode: ",errorCode),deferred.reject({success:!1})):"passed"===lessonStatus||"completed"===lessonStatus?(_lessonComplete=!0,deferred.resolve({success:!0})):(success=scorm.setLessonStatus("incomplete"),success&&scorm.save(),deferred.resolve({success:!0})),deferred.promise}function initLessonLocation(){var deferred=$q.defer(),lmsLocation=scorm.getLessonLocation(),errorCode=scorm.getCode();if(0!==errorCode)$log.log("ErrorCode: ",errorCode),deferred.reject({success:!1});else if(""===lmsLocation)deferred.resolve({success:!0,lmsPageIndex:0});else{var lmsLocationData=lmsLocation.split("|"),lmsPageIndex=parseInt(lmsLocationData[0]),lmsPageStatusData=lmsLocationData[1].split(","),lmsPersistentObjectData=lmsLocationData[2].split("^");lmsPageIndex<0&&(lmsPageIndex=0);for(var len=lmsPageStatusData.length,i=0;i<len;i++){var state=parseInt(lmsPageStatusData[i]),item=_dataProvider[i];state>=2?(item.enabled=!0,item.complete=!0):state>=1?item.enabled=!0:item.complete=item.enabled=!1}len=lmsPersistentObjectData.length;for(var j=0;j<len;j++){var pObjectData=lmsPersistentObjectData[j],pObjectDataList=pObjectData.split(":"),pOName=pObjectDataList[0],pOValue=pObjectDataList[1];persistentData.add(pOName,pOValue)}setPagesCompleteUpTo(lmsPageIndex),deferred.resolve({success:!0,lmsPageIndex:_currentIndex=lmsPageIndex})}return deferred.promise}function setPagesCompleteUpTo(pageIndex){for(var k=0;k<pageIndex;k++)_dataProvider[k].complete=_dataProvider[k].enabled=!0}function getPageListStatus(){for(var dataList=[],itemLen=_dataProvider.length,i=0;i<itemLen;i++){var item=_dataProvider[i];item.complete?dataList[i]=2:item.enabled?dataList[i]=1:dataList[i]=0}return dataList}function formatDate(value){var result;return result=value<10?"0"+value:value.toString()}var _bookmark,_dataProvider,self=this,_lessonComplete=!1,_currentIndex=0;self.init=function(){var deferred=$q.defer();return $timeout(function(){var success=scorm.init();success?$q.all([initLessonStatus(),initLessonLocation()]).then(function(results){deferred.resolve(results[1])},function(results){deferred.reject({success:!1})}):($log.log("ErrorCode: ",scorm.getCode()),deferred.reject({success:!1}))},500),deferred.promise},self.retry=function(){var deferred=$q.defer();return scorm.isConnectionActive()?$q.all([initLessonStatus(),initLessonLocation()]).then(function(results){deferred.resolve(results[1])},function(results){deferred.reject({success:!1})}):deferred.reject({success:!1}),deferred.promise},self.quit=function(){scorm.quit()},self.save=function(){setPagesCompleteUpTo(_currentIndex);var pageListStatus=getPageListStatus().toString(),persistentObject=persistentData.toString(),bookmark=_currentIndex+"|"+pageListStatus+"|"+persistentObject;if(null!=_bookmark&&bookmark===_bookmark)return!0;_bookmark=bookmark;var bookmarkSuccess=scorm.setLessonLocation(bookmark);if(self.isComplete()&&!_lessonComplete){var timeStamp,lessonStatusSuccess=!1,scoreSuccess=!1,timeStampSuccess=!1,date=new Date,year=date.getFullYear(),month=date.getMonth()+1,day=date.getDate(),hour=date.getHours(),minutes=date.getMinutes(),seconds=date.getSeconds();return timeStamp=String(year)+"-"+formatDate(month)+"-"+formatDate(day)+"T"+formatDate(hour)+":"+formatDate(minutes)+":"+formatDate(seconds),lessonStatusSuccess=scorm.setLessonStatus("completed"),scoreSuccess=scorm.setScore("100"),timeStampSuccess=scorm.setCompletionDate(timeStamp),_lessonComplete=!0,!!(bookmarkSuccess&&lessonStatusSuccess&&scoreSuccess&&timeStampSuccess)&&(_lessonComplete=scorm.save())}return!!bookmarkSuccess&&scorm.save()},self.getStudentName=function(){var studentName,studentNameFromLms=scorm.getStudentName();return studentNameFromLms&&(studentName=studentNameFromLms),studentName},self.getStudentId=function(){var studentId,studentIdFromLms=scorm.getStudentId();return studentIdFromLms&&(studentId=studentIdFromLms),studentId},self.getCompletionDate=function(){var timeStamp=scorm.getCompletionDate(),date=new Date;if(timeStamp){var reg=/\d+-\d+-\d+/,dateParts=(reg.exec(timeStamp),String(reg.exec(timeStamp)).split("-"));date=new Date(parseInt(dateParts[0]),parseInt(dateParts[1])-1,parseInt(dateParts[2]))}return date},self.setDataProvider=function(v){_dataProvider=v},self.isComplete=function(){for(var itemLen=_dataProvider.length,i=0;i<itemLen;i++){var item=_dataProvider[i];if(item.complete===!1&&!item.optional)return!1}return!0},self.toString=function(){return"[Bookmark Module]\n"+_bookmark},self.getLessonComplete=function(){return _lessonComplete},self.setCurrentIndex=function(v){_currentIndex=v}}return Bookmark.$inject=["$q","$timeout","$log"],Bookmark}(Scorm,PersistentData),AudioPlayer=function(){function play(){_audio&&_audio.play()}function pause(){_audio&&_audio.pause()}function onEnded(e){_onComplete&&_onComplete(),notify({complete:!0})}function onProgress(e){_onProgress&&_onProgress()}function onUpdate(e){if(_audio){var currentTime=_audio.currentTime,duration=_audio.duration,pct=getPercent(currentTime,duration),sec=Math.round(currentTime%60),min=Math.floor(currentTime/60),hr=Math.round(currentTime/3600);_onUpdate&&_onUpdate({hr:hr,min:min,sec:sec,pct:pct}),notify({hr:hr,min:min,sec:sec,pct:pct}),_output&&console.log("hr: "+hr+" min: "+min+" sec: "+sec+" pct: "+pct)}}function getPercent(value,max){return Math.round(value/max*100)}function playWithSource(v){setSource(v),setAutoPlay(!0)}function setAutoPlay(v){_autoPlay=v}function getAutoPlay(){return _autoPlay}function setOnComplete(v){_onComplete=v}function setOnProgress(v){_onProgress=v}function setOnUpdate(v){_onUpdate=v}function setSource(v){void 0!==v&&(_source=v,_audio?(_audio.src=_source,_autoPlay&&_audio.play()):(_audio=new Audio(_source),_audio.autoplay=_autoPlay,_audio.addEventListener("ended",onEnded),_audio.addEventListener("progress",onProgress),_audio.addEventListener("timeupdate",onUpdate)),_audio.autoplay=_autoPlay)}function getSource(){return _source}function setOutput(v){_output=v}function addObserver(v){_observerList.push(v)}function removeObserver(v){for(var i=0;i<_observerList.length;i++){var existingObserver=_observerList[i];if(existingObserver===v)return _observerList.splice(i,1),!0}return!1}function notify(){for(var args=Array.prototype.slice.call(arguments,0),i=0;i<_observerList.length;i++){var existingObserver=_observerList[i];existingObserver.update.apply(null,args)}}var _source,_audio,_onComplete,_onProgress,_onUpdate,_autoPlay=!0,_output=!1,_observerList=[];return{setSource:setSource,getSource:getSource,setAutoPlay:setAutoPlay,getAutoPlay:getAutoPlay,setOnComplete:setOnComplete,setOnProgress:setOnProgress,setOnUpdate:setOnUpdate,playWithSource:playWithSource,setOuput:setOutput,play:play,pause:pause,addObserver:addObserver,removeObserver:removeObserver}}(),AppUiController=function($){"use strict";function init(){$("#nextBtn").click(function(){_onNextPage&&_onNextPage(),prompNextBtn(!1)}),$("#backBtn").click(function(){_onPrevPage&&_onPrevPage()}),$("#menuBtn").click(function(){_menuOpen=!_menuOpen,_menuOpen?openMenu():closeMenu()}),$("#settingsBtn").click(function(){_settingsOpen=!_settingsOpen,_settingsOpen?openSettings():closeSettings()}),$("#audioBtn").click(function(){toggleAudio()}),$("#certBtn").click(function(){_onCertificate&&_onCertificate()}),$("#replayBtn").click(replayPage),$("#playPauseBtn").click(togglePlayPause)}function openMenu(){$("#navigation").addClass("show"),_settingsOpen&&closeSettings()}function closeMenu(){_menuOpen=!1,$("#navigation").removeClass("show")}function enableAllPages(){_onEnableAllPages&&_onEnableAllPages()}function completeAllPages(){_onCompleteAllPages&&_onCompleteAllPages()}function completePage(){_onCompletePage&&_onCompletePage()}function openSettings(){$("#settings").addClass("show"),$("#helpBtn").unbind("click"),$("#helpBtn").click(openHelp),$("#glossaryBtn").unbind("click"),$("#glossaryBtn").click(openGlossary),$("#disProgressBtn").unbind("click"),$("#disProgressBtn").click(toggleProgressBars),$("#enableAllPagesBtn").unbind("click"),$("#enableAllPagesBtn").click(enableAllPages),$("#completeAllPagesBtn").unbind("click"),$("#completeAllPagesBtn").click(completeAllPages),$("#completePageBtn").unbind("click"),$("#completePageBtn").click(completePage),$("#replayBtn").unbind("click"),$("#replayBtn").click(replayPage),_menuOpen&&closeMenu()}function closeSettings(){_settingsOpen=!1,$("#settings").removeClass("show")}function openHelp(){$("#help").addClass("show"),$("#closeHelpBtn").click(closeHelp),_helpOpen=!0,_settingsOpen&&closeSettings()}function closeHelp(){_helpOpen&&$("#help").hasClass("show")&&($("#help").removeClass("show"),_helpOpen=!1)}function openGlossary(){$("#glossary").addClass("show"),$("#closeGlossaryBtn").click(closeGlossary),_glossaryOpen=!0,_settingsOpen&&closeSettings()}function closeGlossary(){_glossaryOpen&&$("#glossary").hasClass("show")&&($("#glossary").removeClass("show"),_glossaryOpen=!1)}function replayPage(){_onReplayPage&&_onReplayPage()}function toggleProgressBars(){_showProgressBars=!_showProgressBars,_showProgressBars?showProgressBars():hideProgressBars()}function showProgressBars(){$("#pageProgressBar").removeClass("hidden"),$("#courseProgressBar").removeClass("hidden"),$("#appSectionProgressBar").removeClass("hidden")}function hideProgressBars(){$("#pageProgressBar").addClass("hidden"),$("#courseProgressBar").addClass("hidden"),$("#appSectionProgressBar").addClass("hidden")}function toggleAudio(){_muted=!_muted,mute(_muted)}function mute(v){}function togglePlayPause(){_playPauseBtnSelected=!_playPauseBtnSelected,_playPauseBtnSelected?_onPlay&&_onPlay():_onPause&&_onPause(),prompPlayBtn(!1),update()}function prompPlayBtn(v){v?$("#playPauseBtn").addClass("pulse"):$("#playPauseBtn").removeClass("pulse")}function prompNextBtn(v){v?$("#nextBtn").addClass("pulse"):$("#nextBtn").removeClass("pulse")}function prompCertificateBtn(v){v?$("#certBtn").addClass("pulse"):$("#certBtn").removeClass("pulse")}function prompCertificateBtnLastPage(v){v?$("#certBtn").addClass("pulse last-page"):$("#certBtn").removeClass("pulse last-page")}function showCertificateBtn(v){v?$("#certBtn").addClass("show"):$("#certBtn").removeClass("show")}function scrollToTop(){$("#appContent").scrollTop=0}function setBackBtnEnabled(v){_backBtnEnabled=v,update()}function setNextBtnEnabled(v){_nextBtnEnabled=v,update()}function setOnNextPage(v){_onNextPage=v}function setOnPrevPage(v){_onPrevPage=v}function setOnReplayPage(v){_onReplayPage=v}function setOnPlay(v){_onPlay=v}function setOnPause(v){_onPause=v}function setOnCertificate(v){_onCertificate=v}function setPlayPauseButtonEnabled(v){_playPauseBtnEnabled=v,update()}function setPlayPauseBtnSelected(v){_playPauseBtnSelected=v,update()}function setNextBtnEnabled(v){_nextBtnEnabled=v,update()}function setBackBtnEnabled(v){_backBtnEnabled=v,update()}function setMenuBtnEnabled(v){_menuBtnEnabled=v,closeMenu(),update()}function setSettingsBtnEnabled(v){_settingsBtnEnabled=v,closeSettings(),update()}function setOnCompleteAllPages(v){_onCompleteAllPages=v}function setOnEnableAllPages(v){_onEnableAllPages=v}function setOnCompletePage(v){_onCompletePage=v}function update(){_menuBtnEnabled?$("#menuBtn").removeClass("disabled"):$("#menuBtn").addClass("disabled"),_settingsBtnEnabled?$("#settingsBtn").removeClass("disabled"):$("#settingsBtn").addClass("disabled"),_nextBtnEnabled?$("#nextBtn").removeClass("disabled"):$("#nextBtn").addClass("disabled"),_backBtnEnabled?$("#backBtn").removeClass("disabled"):$("#backBtn").addClass("disabled"),_playPauseBtnEnabled?$("#playPauseBtn").removeClass("disabled"):($("#playPauseBtn").addClass("disabled"),prompPlayBtn(!1)),_playPauseBtnSelected?$("#playPauseBtn").addClass("glyphicon-pause"):$("#playPauseBtn").removeClass("glyphicon-pause")}var _onNextPage,_onPrevPage,_onReplayPage,_onPlay,_onPause,_onCertificate,_onEnableAllPages,_onCompleteAllPages,_onCompletePage,_muted=!1,_menuOpen=!1,_settingsOpen=!1,_helpOpen=!1,_glossaryOpen=!1,_playPauseBtnSelected=!0,_playPauseBtnEnabled=!1,_backBtnEnabled=!1,_nextBtnEnabled=!1,_settingsBtnEnabled=!1,_menuBtnEnabled=!1,_showProgressBars=!0;return{init:init,setBackBtnEnabled:setBackBtnEnabled,setNextBtnEnabled:setNextBtnEnabled,setPlayPauseBtnEnabled:setPlayPauseButtonEnabled,setPlayPauseBtnSelected:setPlayPauseBtnSelected,setMenuBtnEnabled:setMenuBtnEnabled,setSettingsBtnEnabled:setSettingsBtnEnabled,setOnNextPage:setOnNextPage,setOnPrevPage:setOnPrevPage,setOnReplayPage:setOnReplayPage,setOnPlay:setOnPlay,setOnPause:setOnPause,openMenu:openMenu,closeMenu:closeMenu,openSettings:openSettings,closeSettings:closeSettings,openHelp:openHelp,closeHelp:closeHelp,openGlossary:openGlossary,closeGlossary:closeGlossary,scrollToTop:scrollToTop,setOnCertificate:setOnCertificate,prompNextBtn:prompNextBtn,prompCertificateBtn:prompCertificateBtn,prompPlayBtn:prompPlayBtn,showCertificateBtn:showCertificateBtn,prompCertificateBtnLastPage:prompCertificateBtnLastPage,setOnCompletePage:setOnCompletePage,setOnCompleteAllPages:setOnCompleteAllPages,setOnEnableAllPages:setOnEnableAllPages}}(jQuery);Section.prototype.toString=function(){return"Section (id: "+this.id+", name: "+this.name+")"},Page.prototype.toString=function(){return"Page (id: "+id+", name: "+this.name+")"};var DataUtils=function(){function parseConfig(v){var parser,xmlDoc,result;parser=new DOMParser,xmlDoc=parser.parseFromString(v,"text/xml");var demo="true"===getRoot(xmlDoc).getAttribute("demo"),title={};return getNameLabel(getRoot(xmlDoc),title),result=parseContent(xmlDoc),{title:title,sectionList:result.sections,pageList:result.pages,demo:demo,certificate:parseCertificate(xmlDoc),language:parseLanguageConfig(xmlDoc)}}function parseLanguageConfig(v){var selectedLanguage,supportedLanguages,config=v.getElementsByTagName("language")[0],enabled=!1,error=!1;if(config&&(enabled="true"===config.getAttribute("enabled"))){if(selectedLanguage=config.getAttribute("value"),supportedLanguages=config.getAttribute("values"),error=isEmptyOrNull(selectedLanguage))throw Error("Error: Parsing language config value attribute was not defined in config!");if(error=isEmptyOrNull(supportedLanguages))throw Error("Error: Parsing language config values attribute was not defined in config!");
supportedLanguages=supportedLanguages.split(","),error=!0;for(var language=0;language<supportedLanguages.length&&error;language++)selectedLanguage===supportedLanguages[language]&&(error=!1);if(error)throw Error("Error: "+selectedLanguage+" is not a supported language or was not defined in config! The available options are: "+supportedLanguages.toString())}return{value:selectedLanguage,enabled:enabled,values:supportedLanguages}}function isEmptyOrNull(v){return void 0===v||null==v}function parseCertificate(v){var certData,extCertId,certificateFile,result={enabled:!0,showStudentId:!0,extCertId:"",link:null};try{certData=v.getElementsByTagName("certificate")[0],result.enabled="true"==certData.getAttribute("enabled"),result.showStudentId="true"==certData.getAttribute("showStudentId"),extCertId=certData.getAttribute("extCertId"),certificateFile=certData.getElementsByTagName("link")[0],null==extCertId&&void 0==extCertId||(result.extCertId=extCertId),null!=certificateFile&&void 0!=certificateFile&&""!=certificateFile&&(result.link=certificateFile.textContent)}catch(e){console.log("Error occurred while parsing certificate node!")}return result}function parseContent(v){var sectionListData,sectionList=[],pageList=[];try{sectionListData=v.getElementsByTagName("section");for(var i=0;i<sectionListData.length;i++){var sectionData=sectionListData[i],section=new Section(sectionData.getAttribute("id"),sectionData.getAttribute("name"),"true"===sectionData.getAttribute("enabled"),"true"===sectionData.getAttribute("selected"),null==sectionData.getAttribute("inmenu")||"true"===sectionData.getAttribute("inmenu"));getNameLabel(sectionData,section);for(var pageListData=sectionData.getElementsByTagName("page"),j=0;j<pageListData.length;j++){var pageData,pageController,page;pageData=pageListData[j],pageController=pageData.getAttribute("controller"),null==pageController&&(pageController="PageController"),page=new Page(pageList.length,pageData.getAttribute("id"),pageData.getAttribute("name"),pageController,pageData.getAttribute("href"),pageData.getAttribute("templateUrl"),"true"==pageData.getAttribute("complete"),"true"==pageData.getAttribute("enabled"),null==pageData.getAttribute("inmenu")||"true"===pageData.getAttribute("inmenu")),getNameLabel(pageData,page),page.optional="true"==pageData.getAttribute("optional"),page.parent=section,page.pageFinishedCommand=pageData.getAttribute("pageFinished"),pageList.push(page),section.children.push(page)}sectionList.push(section)}}catch(e){alert("Failed to parse xml!")}return{sections:sectionList,pages:pageList}}function getNameLabel(node,reference){try{var NameNode=node.getElementsByTagName("name")[0];if(NameNode.childNodes.length)for(var nameIndex=0;nameIndex<NameNode.childNodes.length;nameIndex++)1==NameNode.childNodes[nameIndex].nodeType&&(reference[NameNode.childNodes[nameIndex].nodeName]=NameNode.childNodes[nameIndex].textContent);else reference.label=NameNode.textContent}catch(e){reference.label=""}}function parseSettingsList(list){for(var result=[],i=0;i<list.length;i++){var settingData,settingId,settingName,settingSelected,setting,settingIsToggle;settingData=list[i],settingId=settingData.getAttribute("id"),settingName=settingData.getAttribute("name"),settingSelected=1==parseInt(settingData.getAttribute("selected")),settingIsToggle=1==parseInt(settingData.getAttribute("isToggle")),setting={settingId:settingId,name:settingName,selected:settingSelected,isToggle:settingIsToggle},result.push(setting)}return result}function parseSettings(v){var debugListData,settingListData,parser,xmlDoc,result={settings:[],debugs:[],demo:!1};try{parser=new DOMParser,xmlDoc=parser.parseFromString(v,"text/xml"),result.demo="true"===this.getRoot(xmlDoc).getAttribute("demo"),debugListData=xmlDoc.getElementsByTagName("debug"),settingListData=xmlDoc.getElementsByTagName("setting"),result.debugs=parseSettingsList(debugListData),result.settings=parseSettingsList(settingListData)}catch(e){alert("Failed to parse xml!")}return result}function parseGlossary(v){var glossaryListData,parser,xmlDoc,result={list:[]};try{parser=new DOMParser,xmlDoc=parser.parseFromString(v,"text/xml");var title=getRoot(xmlDoc).getElementsByTagName("name")[0].textContent;result.title=title,glossaryListData=xmlDoc.getElementsByTagName("term");for(var i=0;i<glossaryListData.length;i++){var glossaryData,name,definition,glossaryItem;glossaryData=glossaryListData[i],name=glossaryData.getElementsByTagName("name")[0].textContent,definition=glossaryData.getElementsByTagName("definition")[0].textContent,glossaryItem={name:name,definition:definition},result.list.push(glossaryItem)}}catch(e){alert("Failed to parse xml!")}return result}function getRoot(v){var root=v.getElementsByTagName("root");return root[0]}return{parseConfig:parseConfig,parseSettings:parseSettings,parseGlossary:parseGlossary}}();!function(angular){"use strict";var dependencies=["ngRoute","ui.choices","ngSanitize","smoothScroll","cm.network","cm.scorm","cm-persistent-data","cm-certificate","cm-test","cm-widgets","cm-media","cm-vimeo","cm-assessments","cm-functionalities","cm-components","cm-cue-system","cm-browser-util","cm-utils"];angular.module("AppMain",dependencies).service("Bookmark",Bookmark)}(angular),function(module){"use strict";module.controller("AppController",function($window,$scope,$rootScope,$route,$routeParams,$location,$http,$timeout,$log,EngineApi,UiApi,Debug,CertificateService,BrowserUtilService,config,CMAudioPlayer,HelpService,SmoothScrollTo,LangService,Bookmark){function onPrevPage(){$scope.$apply($scope.prevPage())}function onNextPage(){AppUiController.setNextBtnEnabled(!1),$scope.$apply($scope.nextPage())}function validateCertificate(){AppUiController.showCertificateBtn(config.certificate.enabled&&Bookmark.getLessonComplete()),AppUiController.prompCertificateBtnLastPage(_currentIndex===_pageList.length-1&&config.certificate&&Bookmark.getLessonComplete())}function onCertificate(){if(Bookmark.getLessonComplete()){var date=Bookmark.getCompletionDate(),studentName=Bookmark.getStudentName(),studentId="";if(config.certificate.link)$window.open(config.certificate.link,"_blank");else if(config.certificate.showStudentId&&(studentId=Bookmark.getStudentId()),null==date||null==studentName||config.demo){if(config.demo){var day=date.getDate(),month=date.getMonth()+1,year=date.getFullYear(),formattedDate=month+"/"+day+"/"+year;CertificateService.createCertificate("Student Name",formattedDate,config.certificate.extCertId+studentId,"assets/images/certificate.jpg","Certificate.pdf")}}else{var day=date.getDate(),month=date.getMonth()+1,year=date.getFullYear(),formattedDate=month+"/"+day+"/"+year;CertificateService.createCertificate(studentName,formattedDate,config.certificate.extCertId+studentId,"assets/images/certificate.jpg","Certificate.pdf")}}}function onPageFinished(){$scope.currentPage.complete=!0,_currentIndex!==_pageList.length-1?(_pageList[_currentIndex+1].enabled=!0,AppUiController.setNextBtnEnabled(!0),AppUiController.prompNextBtn(!0)):(AppUiController.setNextBtnEnabled(!1),AppUiController.prompNextBtn(!1)),config.demo||(Bookmark.setCurrentIndex(_currentIndex),Bookmark.save()),"next"===$scope.currentPage.pageFinishedCommand&&(AppUiController.prompNextBtn(!1),$scope.nextPage()),validateCertificate(),updateProgressBar()}function updateProgressBar(){$scope.courseProgress=getPageProgressPercent(_pageList)}function getPageProgressPercent(v){for(var count=0,total=v.length,len=total,i=0;i<len;i++){var item=v[i];count+=item.complete?1:0}var pct=count/total*100;return pct}function getPageIndex(v){for(var found=!1,foundIndex=-1,index=0;index<_pageList.length&&!found;index++){var existingPageId=_pageList[index].id;existingPageId===v&&(found=!0,foundIndex=index)}return foundIndex}function getPageAtIndex(v){if(v!==-1)return _pageList[v]}function getPageIdFromQuery(v){var pageId,url=v,pieces=url.split("#/");return pieces.length&&(pageId=pieces[pieces.length-1]),pageId}function setPage(page){page.enabled=!0,$location.path(page.id)}function replayPage(){$route.reload()}function getPageById(v){for(var found=!1,result=null,index=0;index<_pageList.length&&!found;index++){var existingPage=_pageList[index];existingPage.id===v&&(found=!0,result=existingPage)}return result}function setPageById(id){var page=getPageById(id);page&&setPage(page)}function loadGlossary(){$http.get("data/"+$scope.lang+"/glossary.xml").then(function(response){$scope.glossary=DataUtils.parseGlossary(response.data)})}function onBookmarkInitSuccess(value){value.success&&setPage(getPageAtIndex(value.lmsPageIndex))}function onBookmarkInitError(value){$scope.loading=!1,$scope.showBookmarkError=!0}function initBookmark(){Bookmark.init().then(onBookmarkInitSuccess,onBookmarkInitError)}var _currentIndex=0,_pageList=config.pageList,_isMobile=BrowserUtilService.isMobile();$scope.lang="",LangService.init(config.language),LangService.getEnabled()&&($scope.lang=LangService.getLanguage()),$scope.showBookmarkError=!1,$scope.debug=Debug,$scope.currentPage=null,$scope.helpService=HelpService,$scope.sectionList=config.sectionList,$scope.pageList=config.pageList,$scope.appTitle=config.title,$scope.glossary=null,$scope.sectionName="",$scope.pageName="",$scope.courseProgress=0,$scope.pageProgress=0,$scope.loading=!0,$scope.appStarted=!0,$scope.helpPage="pages/help_"+$scope.lang+".html",Bookmark.setDataProvider(_pageList),AppUiController.setOnNextPage(onNextPage),AppUiController.setOnPrevPage(onPrevPage),AppUiController.setOnPause(AudioPlayer.pause),AppUiController.setOnPlay(AudioPlayer.play),AppUiController.setOnCertificate(onCertificate),UiApi.setOnPlayPauseBtnEnabled(AppUiController.setPlayPauseBtnEnabled),UiApi.setOnBackBtnEnabld(AppUiController.setBackBtnEnabled),UiApi.setOnBackBtnEnabld(AppUiController.setNextBtnEnabled),UiApi.setOnMenuBtnEnabled(AppUiController.setMenuBtnEnabled),UiApi.setOnSettingsBtnEnabled(AppUiController.setSettingsBtnEnabled),Debug.setDataProvider(_pageList),EngineApi.setOnPageFinished(onPageFinished),EngineApi.setOnSetPageById(setPageById),EngineApi.setOnNextPage(function(){$scope.nextPage()}),EngineApi.setOnPrevPage(function(){$scope.prevPage()}),EngineApi.setOnStopContent(AudioPlayer.pause),Debug.setDataProvider(_pageList),AppUiController.setOnEnableAllPages(function(){Debug.enableAllPages(),updateProgressBar(),$scope.$apply()}),AppUiController.setOnCompleteAllPages(function(){Debug.completeAllPages(),onPageFinished(),updateProgressBar(),$scope.$apply()}),AppUiController.setOnCompletePage(function(){onPageFinished(),$scope.$apply()}),AppUiController.setOnReplayPage(function(){replayPage()});var AppUiComponent={update:function(){arguments[0].complete?AppUiController.setPlayPauseBtnSelected(!1):($scope.pageProgress=arguments[0].pct,$scope.$apply())}};AudioPlayer.addObserver(AppUiComponent),$rootScope.$on("$locationChangeStart",function(event,newUrl,oldUrl){var pageId=getPageIdFromQuery(newUrl),page=getPageById(pageId);page&&(page.enabled?(AudioPlayer.pause(),CMAudioPlayer.dispose(),AudioPlayer.pause(),CMAudioPlayer.dispose(),$scope.currentPage&&($scope.currentPage.selected=$scope.currentPage.parent.selected=!1),$scope.currentPage=page,_currentIndex=getPageIndex($scope.currentPage.id),$scope.pageProgress=0,config.demo||(Bookmark.setCurrentIndex(_currentIndex),Bookmark.save()),AppUiController.setNextBtnEnabled(!1),AppUiController.setBackBtnEnabled(!1),AppUiController.setMenuBtnEnabled(!1),AppUiController.setSettingsBtnEnabled(!1),AppUiController.setPlayPauseBtnEnabled(!1),AppUiController.scrollToTop(),$scope.loading=!0):event.preventDefault())}),$scope.onContentClick=function(){AppUiController.closeMenu(),AppUiController.closeSettings()},$scope.nextPage=function(){_currentIndex!==_pageList.length-1&&setPage($scope.currentPage.nextCommand?getPageById($scope.currentPage.nextCommand):_pageList[++_currentIndex])},$scope.prevPage=function(){0!==_currentIndex&&setPage($scope.currentPage.backCommand?getPageById($scope.currentPage.backCommand):_pageList[--_currentIndex])},$scope.setLanguage=function(v){LangService.setLanguage(v),$scope.lang=config.language.value=v,$scope.helpPage="pages/help_"+$scope.lang+".html",loadGlossary(),replayPage()},$scope.to_html=function(html_code){return $sce.trustAsHtml(html_code)},$rootScope.$on("$routeChangeSuccess",function(event,current,previous){AppUiController.setPlayPauseBtnSelected(!_isMobile),AudioPlayer.setAutoPlay(!_isMobile),AppUiController.setPlayPauseBtnEnabled(!0),AppUiController.prompPlayBtn(_isMobile),AppUiController.prompNextBtn(!1),AppUiController.setMenuBtnEnabled(!0),AppUiController.setSettingsBtnEnabled(!0)}),$rootScope.$on("$routeChangeError",function(event,current,previous,rejections){}),$scope.$on("$viewContentLoaded",function(event){$scope.currentPage&&($scope.sectionName=$scope.currentPage.parent.name,$scope.pageName=$scope.currentPage.name,AppUiController.setBackBtnEnabled(!(0===_currentIndex)),AppUiController.setNextBtnEnabled(_currentIndex!==_pageList.length-1&&_pageList[_currentIndex].complete),validateCertificate(),$scope.pageProgress=0,updateProgressBar(),$scope.currentPage.enabled=$scope.currentPage.selected=$scope.currentPage.parent.selected=!0,SmoothScrollTo.scrollContainerToTop(),$scope.loading=!1)}),$scope.tryAgain=function(){$scope.showBookmarkError=!1,$scope.loading=!0,Bookmark.retry().then(onBookmarkInitSuccess,onBookmarkInitError)},$window.onbeforeunload=function(){},$location.path("/"),AppUiController.init(),loadGlossary(),config.demo?setPage(getPageAtIndex(0)):initBookmark()})}(angular.module("AppMain")),function(module){"use strict";module.config(["$routeProvider","config",function($routeProvider,config){$routeProvider.when("/",{template:""}).when("/:name*",{templateUrl:function(v){var lang="";null!=config.language.value&&(lang=config.language.value+"/");for(var i=0;i<config.pageList.length;i++){var item=config.pageList[i];if(v.name===item.id)return"pages/"+lang+item.templateUrl}return"pages/"+lang+"404.html"},controller:"PageController",resolve:{delay:function($q,$timeout){var delay=$q.defer();return $timeout(delay.resolve,1e3),delay.promise}}}).otherwise({templateUrl:"pages/404.html"})}])}(angular.module("AppMain")),function(module){"use strict";function fetchData(){var initInjector=angular.injector(["ng","cm-browser-util"]),$http=initInjector.get("$http");return $http.get("data/config.xml").then(function(response){var config=DataUtils.parseConfig(response.data);config.demo&&Scorm.setEnabled(!1),module.constant("config",config)},function(error){throw"Failed to load config! "+error})}function bootstrapApplication(){angular.element(document).ready(function(){angular.bootstrap(document,["AppMain"])})}fetchData().then(bootstrapApplication)}(angular.module("AppMain")),function(module){module.service("SmoothScrollTo",function($rootScope,$window,smoothScroll){this.offset=50,this.scrollToId=function(id){if("undefined"==typeof id||null==id)throw"id cannot be null or undefined!";var element=document.getElementById(id);if(null==element)throw"element not found!";var options={offset:this.offset,containerId:"appContent"};$rootScope.$emit("scrollingToId",{id:id}),smoothScroll(element,options)},this.scrollContainerToTop=function(){var $parentDiv=$("#appContent");$parentDiv.scrollTop(0,0)},this.scrollContainerToBottom=function(){var $parentDiv=$("#appContent");$parentDiv.scrollTop(0,0)},this.scrollToTop=function(){$window.scrollTo(0,0)},this.scrollToBottom=function(){$window.scrollTo(0,document.body.scrollHeight)}})}(angular.module("AppMain")),function(module){"use strict";module.service("HelpService",function($window){function onNext(){index==count-1?(angular.element(result[index]).css("display","none"),index-=count-1,angular.element(result[index]).css("display","block")):(angular.element(result[index]).css("display","none"),angular.element(result[++index]).css("display","block"))}function onPrev(){0==index?(angular.element(result[index]).css("display","none"),index=count-1,angular.element(result[index]).css("display","block")):(angular.element(result[index]).css("display","none"),angular.element(result[--index]).css("display","block"))}var result,index,count;this.init=function(){index=0,count=0,result=$window.document.getElementsByClassName("help-item");var nextButtonList=$window.document.getElementsByClassName("help-nav-next"),prevButtonList=$window.document.getElementsByClassName("help-nav-prev");count=result.length;for(var i=0;i<nextButtonList.length;i++){var nBtn=angular.element(nextButtonList[i]);nBtn.bind("click",onNext)}for(var j=0;j<prevButtonList.length;j++){var pBtn=angular.element(prevButtonList[j]);pBtn.bind("click",onPrev)}}})}(angular.module("AppMain")),function(module){"use strict";module.directive("sectionProgressIndicator",function(){function link($scope,$element,$attrs){var offset=0,sections=[],pages=[];$scope.hasOwnProperty("sectionList")&&$scope.hasOwnProperty("pageList")&&(sections=$scope.sectionList,pages=$scope.pageList);for(var i=0;i<sections.length;i++){var element,item=$scope.sectionList[i],children=item.children,left=offset+children.length/pages.length*100;element=angular.element('<div style="left: '+left+'%;"></div>'),$element.append(element),offset=left}}function controller($scope,$element,$attrs){}return{restrict:"EA",replace:!0,link:link,controller:controller,template:"<div></div>"}})}(angular.module("AppMain")),function(module){module.controller("PageController",["$scope","EngineApi","UiApi","SmoothScrollTo","PersistentDataService","CMAudioPlayer",function($scope,EngineApi,UiApi,SmoothScrollTo,PersistentDataService,CMAudioPlayer){$scope.engineApi=EngineApi,$scope.uiApi=UiApi,$scope.cmAudioPlayer=CMAudioPlayer,$scope.persistentDataService=PersistentDataService,$scope.msfScrollToService=SmoothScrollTo,$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover()}])}(angular.module("AppMain")),function(module){"use strict";module.service("EngineApi",function($rootScope){function setOnPageFinished(v){_onPageFinished=v}function setOnNextPage(v){_onNextPage=v}function setOnPrevPage(v){_onPrevPage=v}function setOnSetPageById(v){_onSetPageById=v}function setOnStopContent(v){_onStopContent=v}function pageFinished(){_onPageFinished&&_onPageFinished()}function nextPage(){_onNextPage&&_onNextPage()}function prevPage(){_onPrevPage&&_onPrevPage()}function stopContent(){_onStopContent&&_onStopContent()}function setPageById(v){_onSetPageById&&_onSetPageById(v)}var _onPageFinished,_onNextPage,_onPrevPage,_onSetPageById,_onStopContent;return{setOnPageFinished:setOnPageFinished,setOnNextPage:setOnNextPage,setOnPrevPage:setOnPrevPage,setOnSetPageById:setOnSetPageById,setOnStopContent:setOnStopContent,pageComplete:pageFinished,nextPage:nextPage,prevPage:prevPage,setPageById:setPageById,stopContent:stopContent}})}(angular.module("AppMain")),function(module){"use strict";module.service("UiApi",function($rootScope){function enablePlayBtn(v){setPlayPauseBtnEnabled(v)}function setPlayPauseBtnEnabled(v){_onPlayPauseBtnEnabled&&_onPlayPauseBtnEnabled(v)}function setNextBtnEnabled(v){_onNextBtnEnabled&&_onNextBtnEnabled()}function setBackBtnEnabled(v){_onBackBtnEnabled&&_onBackBtnEnabled()}function setMenuBtnEnabled(v){_onMenuBtnEnabled&&_onMenuBtnEnabled()}function setSettingsBtnEnabled(v){_onSettingsBtnEnabled&&_onSettingsBtnEnabled()}function setOnPlayPauseBtnEnabled(v){_onPlayPauseBtnEnabled=v}function setOnNextBtnEnabled(v){_onNextBtnEnabled=v}function setOnBackBtnEnabld(v){_onBackBtnEnabled=v}function setOnMenuBtnEnabled(v){_onMenuBtnEnabled=v}function setOnSettingsBtnEnabled(v){_onSettingsBtnEnabled=v}var _onPlayPauseBtnEnabled,_onNextBtnEnabled,_onBackBtnEnabled,_onMenuBtnEnabled,_onSettingsBtnEnabled;return{setOnPlayPauseBtnEnabled:setOnPlayPauseBtnEnabled,setOnNextBtnEnabled:setOnNextBtnEnabled,setOnBackBtnEnabld:setOnBackBtnEnabld,setOnMenuBtnEnabled:setOnMenuBtnEnabled,setOnSettingsBtnEnabled:setOnSettingsBtnEnabled,setPlayPauseBtnEnabled:setPlayPauseBtnEnabled,setNextBtnEnabled:setNextBtnEnabled,setBackBtnEnabled:setBackBtnEnabled,setMenuBtnEnabled:setMenuBtnEnabled,setSettingsBtnenabled:setSettingsBtnEnabled,enablePlayBtn:enablePlayBtn}})}(angular.module("AppMain")),function(module){"use strict";module.service("Debug",function(){function enableAllPages(){if(_dataProvider&&_dataProvider.length)for(var index=0;index<_dataProvider.length;index++){var page=_dataProvider[index];page.enabled=!0}}function completeAllPages(){if(_dataProvider&&_dataProvider.length)for(var index=0;index<_dataProvider.length;index++){var page=_dataProvider[index];page.complete=!0,page.enabled=!0}}function setDataProvider(v){_dataProvider=v}var _dataProvider=null;return{setDataProvider:setDataProvider,enableAllPages:enableAllPages,completeAllPages:completeAllPages}})}(angular.module("AppMain"));